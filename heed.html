<div class="sheet-wrapper">
	<div class="logo">
		<img src="https://heed-ttrpg-public-6789.s3.eu-west-2.amazonaws.com/heed-transparent.png" />
	</div>
    <!-- <div class="sheet-heading"> -->
    <!-- </div> -->
    <div class="sheet-exp">
    	<span>
    		<span>Name:</span><br />
    		<input style="width: 90%;" class="sheet-wide" type="text" name="attr_character_name" value="Knave"/>
   		</span>
    	<span>
        	<span>Level:</span><br />
        	<input style="width: 50%; text-align: center;" type="number" name="attr_level" value="1" />
        </span>
        <span>
	        <span>Experience:</span><br />
	        <input style="width: 90%;" class="sheet-wide" type="number" name="attr_exp" value="0" />
        </span>
        <span>
	        <span>Coin in stash:</span><br />
	        <input style="width: 90%;" class="sheet-wide" type="number" name="attr_gold" value="0" />
        </span>
    </div>
    <div class="sheet-hps">
        <span>Hit Points</span>
        <span>Current:&nbsp;<input type="number" name="attr_hp" value="1"/></span>
        <span>Max HP:&nbsp;<input type="number" name="attr_hp_max" value="1"/></span>
    </div>
    <div class="sheet-defence">
    	<span>Defences</span>
    	<span>Def:
    		<input type="number" name="attr_defence" value="0"/>
    	</span>
    	<br />
    	<span>Magic def:
    		<input type="number" name="attr_magic_defence" value="0"/>
   		</span>
    </div>

    <div class="sheet-str">
        <span class="sheet-att-name">Str:&nbsp;<input type="number" name="attr_strength" value="0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled STR}} {{Strength:=[[1d8 + @{strength}]]}}' name='roll_strcheck' /></span>
    </div>
    <div class="sheet-dex">
        <span class="sheet-att-name">Dex:&nbsp;<input type="number" name="attr_dexterity" value="0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled DEX}} {{Dexterity:=[[1d8 + @{dexterity}]]}}' name='roll_dexcheck' /></span>
    </div>
        <div class="sheet-con">
        <span class="sheet-att-name">Con:&nbsp;<input type="number" name="attr_constitution" value="0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled CON}} {{Constitution:=[[1d8 + @{constitution}]]}}' name='roll_concheck' /></span>
    </div>
    <div class="sheet-int">
        <span class="sheet-att-name">Int:&nbsp;<input type="number" name="attr_intelligence" value=0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled INT}} {{Intelligence:=[[1d8 + @{intelligence}]]}}' name='roll_intcheck' /></span>
    </div>
    <div class="sheet-wis">
        <span class="sheet-att-name">Wis:&nbsp;<input type="number" name="attr_wisdom" value="0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled WIS}} {{Wisdom:=[[1d8 + @{wisdom}]]}}' name='roll_wischeck' /></span>
    </div>
    <div class="sheet-cha">
        <span class="sheet-att-name">Cha:&nbsp;<input type="number" name="attr_charisma" value="0"/></span>
        <span class="sheet-att-bon"><button type='roll' value='&{template:default} {{name=@{character_name} rolled CHA}} {{Charisma:=[[1d8 + @{charisma}]]}}' name='roll_chacheck' /></span>
    </div>

	<!-- Define hidden inputs for each weapon's dice value -->
	<input type="hidden" name="attr_attack_1_dice" value="d8">
	<input type="hidden" name="attr_attack_2_dice" value="d8">
	<input type="hidden" name="attr_attack_4_dice" value="d4">
	<input type="hidden" name="attr_attack_5_dice" value="d4">

	<input type="hidden" name="attr_Unarmed_dice" value="d8">
	<input type="hidden" name="attr_Shortsword_dice" value="d4">
	<input type="hidden" name="attr_Axe_dice" value="d4">
	<input type="hidden" name="attr_Dagger_dice" value="d8">
	<input type="hidden" name="attr_Flail_dice" value="d4">
	<input type="hidden" name="attr_Broadsword_dice" value="d4">
	<input type="hidden" name="attr_TwoShortswords_dice" value="d4">
	<input type="hidden" name="attr_Battleaxe_dice" value="d6">
	<input type="hidden" name="attr_Warhammer_dice" value="d6">
	<input type="hidden" name="attr_Flamberge_dice" value="d6">
	<input type="hidden" name="attr_Anastasia_dice" value="d6">

	<input type="hidden" name="attr_Sling_dice" value="d4">
	<input type="hidden" name="attr_Shortbow_dice" value="d4">
	<input type="hidden" name="attr_Crossbow_dice" value="d4">

    <div class="sheet-attacks">
		<span>
        	&nbsp;Melee Weapon
	        <span class="sheet-attack-slot">
		        <select class="sheet-attack-descr" name="attr_attack_1_desc">
		          <option value="Unarmed">Unarmed</option>
		          <option value="Shortsword">Shortsword</option>
		          <option value="Axe">Axe</option>
		          <option value="Dagger">Dagger</option>
		          <option value="Flail">Flail</option>
		          <option value="Broadsword">Broadsword</option>
		          <option value="TwoShortswords">Two Shortswords</option>
		          <option value="Battleaxe">Battleaxe</option>
		          <option value="Warhammer">Warhammer</option>
		          <option value="Flamberge">Flamberge</option>
		          <option value="Anastasia">Anastasia</option>
		        </select>
		        <button type="roll" name="act_attack_1_btn" value='&{template:default} {{name=@{character_name}}} rolled an attack with Strength: {{Weapon=@{attack_1_desc}}} {{Strength:=[[@{attack_1_dice} + @{strength} - ?{targets defence|0}]]}} (WeaponIndex=1)'></button>
	        </span>
	        <span class="sheet-attack-slot">
		        <select class="sheet-attack-descr" name="attr_attack_2_desc">
		          <option value="Unarmed">Unarmed</option>
		          <option value="Shortsword">Shortsword</option>
		          <option value="Axe">Axe</option>
		          <option value="Dagger">Dagger</option>
		          <option value="Flail">Flail</option>
		          <option value="Broadsword">Broadsword</option>
		          <option value="TwoShortswords">Two Shortswords</option>
		          <option value="Battleaxe">Battleaxe</option>
		          <option value="Warhammer">Warhammer</option>
		          <option value="Flamberge">Flamberge</option>
		          <option value="Anastasia">Anastasia</option>
		        </select>
		        <button type="roll" name="act_attack_2_btn" value='&{template:default} {{name=@{character_name}}} rolled an attack with Strength: {{Weapon=@{attack_2_desc}}} {{Strength:=[[@{attack_2_dice} + @{strength} - ?{targets defence|0}]]}} (WeaponIndex=2)'></button>
	        </span>
        </span>
        <span>
	        <span class="sheet-top-break">&nbsp;Ranged Weapon</span>
	        <span class="sheet-attack-slot">
		        <select class="sheet-attack-descr" name="attr_attack_4_desc">
		          <option value="Sling">Sling</option>
		          <option value="Shortbow">Shortbow</option>
		          <option value="Crossbow">Crossbow</option>
		        </select>
		        <button type="roll" name="act_attack_4_btn" value='&{template:default} {{name=@{character_name}}} rolled an attack with Wisdom: {{Weapon=@{attack_4_desc}}} {{Wisdom:=[[@{attack_4_dice} + @{wisdom} - ?{targets defence|0}]]}} (WeaponIndex=4)'></button>
			</span>
	        <span class="sheet-attack-slot">
		        <select class="sheet-attack-descr" name="attr_attack_5_desc">
		          <option value="Sling">Sling</option>
		          <option value="Shortbow">Shortbow</option>
		          <option value="Crossbow">Crossbow</option>
		        </select>
		        <button type="roll" name="act_attack_5_btn" value='&{template:default} {{name=@{character_name}}} rolled an attack with Wisdom: {{Weapon=@{attack_5_desc}}} {{Wisdom:=[[@{attack_5_dice} + @{wisdom} - ?{targets defence|0}]]}} (WeaponIndex=5)'></button>
			</span>
		</span>
    </div>
    <div class="sheet-notes">
        Careers, Notes, etc.
        <textarea name="attr_notes"></textarea>
    </div>
    <div class="sheet-slots">
        <span class="sheet-slots-title">
        	Equipment Slots ( Character Max Slots = <input type="number" name="attr_slots" value="10+@{constitution}" disabled="true"/> )<br />
        	(F) = Fast slot
        </span>
        <span class="sheet-slot">
          <span name="attr_item_1_name">1:</span>
          <textarea type="text" name="attr_item_1_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_1_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_11_name">11:</span>
          <textarea type="text" type="text" name="attr_item_11_desc" value=""/>
           <input class="sheet-quality" type="text" name="attr_item_11_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_2_name">2:</span>
          <textarea type="text" name="attr_item_2_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_2_qual" value=""/>
        </span>
        <span class="sheet-slot">
		 <span name="attr_item_12_name">12:</span>
         <textarea type="text" type="text" name="attr_item_12_desc" value=""/>
         <input class="sheet-quality" type="text" name="attr_item_12_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_3_name">3:</span>
          <textarea type="text" name="attr_item_3_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_3_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_13_name">13:</span>
          <textarea type="text" name="attr_item_13_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_13_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_4_name">4:</span>
          <textarea type="text" name="attr_item_4_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_4_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_14_name">14:</span>
          <textarea type="text" name="attr_item_14_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_14_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_5_name">5:</span>
          <textarea type="text" name="attr_item_5_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_5_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_15_name">15:</span>
          <textarea type="text" name="attr_item_15_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_15_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_6_name">6:</span>
          <textarea type="text" name="attr_item_6_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_6_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_16_name">16:</span>
          <textarea type="text" name="attr_item_16_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_16_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_7_name">7:</span>
          <textarea type="text" name="attr_item_7_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_7_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_17_name">17:</span>
          <textarea type="text" name="attr_item_17_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_17_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_8_name">8:</span>
          <textarea type="text" name="attr_item_8_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_8_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_18_name">18:</span>
          <textarea type="text" name="attr_item_18_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_18_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_9_name">9:</span>
          <textarea type="text" name="attr_item_9_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_9_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_19_name">19:</span>
          <textarea type="text" name="attr_item_19_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_19_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_10_name">10:</span>
          <textarea type="text" name="attr_item_10_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_10_qual" value=""/>
        </span>
        <span class="sheet-slot">
          <span name="attr_item_20_name">20:</span>
          <textarea type="text" name="attr_item_20_desc" value=""/>
          <input class="sheet-quality" type="text" name="attr_item_20_qual" value=""/>
        </span>
    </div>
    <div class="sheet-slots-wide">
	    <span class="sheet-slot-wide">
	      Jewellery, etc.:
	      <textarea type="text" name="attr_item_jewellery_desc" value=""/>
	    </span>
    </div>
</div>


<script type="text/worker">
    const setDiceValue = (attackNum, weapon) => {
        getAttrs([`${weapon}_dice`], function(values) {
            let weaponDice = values[`${weapon}_dice`] || "d4";
            setAttrs({
                [`attack_${attackNum}_dice`]: weaponDice
            });
        });
    };

    on("change:attack_1_desc", function(eventInfo) {
        const weapon = eventInfo.newValue;
        setDiceValue(1, weapon);
    });

    on("change:attack_2_desc", function(eventInfo) {
        const weapon = eventInfo.newValue;
        setDiceValue(2, weapon);
    });

    on("change:attack_4_desc", function(eventInfo) {
        const weapon = eventInfo.newValue;
        setDiceValue(4, weapon);
    });

    on("change:attack_5_desc", function(eventInfo) {
        const weapon = eventInfo.newValue;
        setDiceValue(5, weapon);
    });

    on("change:dexterity sheet:opened", function() {
    	getAttrs(['dexterity'], function(values) {
 	    	const updatedDexterity = parseInt(values.dexterity, 10);

			for (let slot = 1; slot <= 20; slot++) {
				if (slot <= updatedDexterity) {
					setAttrs({
						[`item_${slot}_name`]: `${slot} (F):`
					});
				} else {
					setAttrs({
						[`item_${slot}_name`]: `${slot}:`
					});
				}
			}
		});
    });
</script>
